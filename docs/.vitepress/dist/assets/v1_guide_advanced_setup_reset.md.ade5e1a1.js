import{_ as s,o as e,c as a,V as l}from"./chunks/framework.5f0cae6b.js";const D=JSON.parse('{"title":"Removing blocks","description":"","frontmatter":{},"headers":[],"relativePath":"v1/guide/advanced/setup/reset.md","filePath":"v1/guide/advanced/setup/reset.md"}'),n={name:"v1/guide/advanced/setup/reset.md"},o=l(`<h1 id="removing-blocks" tabindex="-1">Removing blocks <a class="header-anchor" href="#removing-blocks" aria-label="Permalink to &quot;Removing blocks&quot;">​</a></h1><p>Sometimes you need an ability to remove the block and logs. One of the use cases is that you are blocked yourself, or that you want security researchers to pentest your system (...they will constantly be blocked). One way of doing that is to disable Tripwire, but a much better way is to give them a reset url.</p><p>With a reset-url someone can access the page to remove all blocks/logs with their ip. They will be instantly unblocked and have access to the site again.</p><p>For this to work you need to</p><ul><li>Register the reset url</li><li>Enable the reset</li><li>Specify how many minutes the reset url will be available. After that time the reset-url will do nothing.</li></ul><p>In your app routes you need to add this line under the grouping and <code>guest</code> middlewares. These routes need to be publicly available without any tripwire middleware.</p><div class="language-php"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki material-theme-palenight has-focused-lines"><code><span class="line"><span style="color:#FFCB6B;">Route</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">prefix</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">myprefix</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">name</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">my-name.</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">group</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line has-focus"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">Route</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">TripwireResetRoutes</span><span style="color:#89DDFF;">();</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">//  path: myprefix/guest/reset ; name: &#39;my-name.tripwire.guest.logs.reset&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">});</span></span></code></pre></div><p>and update your <code>.env</code></p><div class="language-php"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">TRIPWIRE_RESET_ENABLED</span><span style="color:#89DDFF;">=true</span></span>
<span class="line"><span style="color:#A6ACCD;">TRIPWIRE_RESET_LINK_EXPIRATION_MINUTES</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">60</span><span style="color:#89DDFF;">*</span><span style="color:#F78C6C;">24</span><span style="color:#89DDFF;">*</span><span style="color:#F78C6C;">30</span><span style="color:#A6ACCD;">     </span><span style="color:#676E95;font-style:italic;">// how many minutes will this reset-url be available</span></span></code></pre></div><h2 id="hard-delete-blocks" tabindex="-1">Hard delete blocks <a class="header-anchor" href="#hard-delete-blocks" aria-label="Permalink to &quot;Hard delete blocks&quot;">​</a></h2><p>By default the logs and blocks will be soft-deleted from your database. If you want to hard delete them add the following to your .env</p><div class="language-php"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">TRIPWIRE_RESET_DELETE_SOFT</span><span style="color:#89DDFF;">=false;</span></span></code></pre></div><h2 id="persistent-blocks" tabindex="-1">Persistent Blocks <a class="header-anchor" href="#persistent-blocks" aria-label="Permalink to &quot;Persistent Blocks&quot;">​</a></h2><p>The use case is that sometimes you want to keep certain ips to remain blocked no matter what. So that even if there is a cleanup of the logs, these persistent blocks remain. As long as a block is persistent, it will not be removed by the reset-url.</p><div class="danger custom-block"><p class="custom-block-title">Persistent Blocks</p><p>The database hold a field called: <code>persistent_block</code> when this flag is set, this block is not affected by the reset-url. These flags need to be cleared before the blocks can be removed with a reset-url</p></div><h2 id="generate-a-reset-url" tabindex="-1">Generate a reset url <a class="header-anchor" href="#generate-a-reset-url" aria-label="Permalink to &quot;Generate a reset url&quot;">​</a></h2><p>In your routes file specify the prefix/middleware/group and register the admin tripwire routes</p><p>This way you can specify where the routes are in your path and namespaces and what middleware you want to apply</p><p>These routes should be only accessible by admins</p><div class="language-php"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki material-theme-palenight has-focused-lines"><code><span class="line"><span style="color:#FFCB6B;">Route</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">prefix</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">middleware</span><span style="color:#89DDFF;">([</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">web</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">auth</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">admin</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">])</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">group</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line has-focus"><span style="color:#A6ACCD;">            </span><span style="color:#FFCB6B;">Route</span><span style="color:#89DDFF;">::</span><span style="color:#82AAFF;">TripwireAdminRoutes</span><span style="color:#89DDFF;">();</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// make sure only admins have access to this route</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">});</span></span></code></pre></div>`,20),t=[o];function p(r,c,i,y,d,F){return e(),a("div",null,t)}const u=s(n,[["render",p]]);export{D as __pageData,u as default};
